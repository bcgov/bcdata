<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="bcdata">
<title>Exploring Silviculture Data with bcdata • bcdata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Mono-0.4.4/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Exploring Silviculture Data with bcdata">
<meta property="og:description" content="bcdata">
<meta property="og:image" content="https://bcgov.github.io/bcdata/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">bcdata</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/bcdata.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/efficiently-query-spatial-data-in-the-bc-data-catalogue.html">Querying Spatial Data with bcdata</a>
    <a class="dropdown-item" href="../articles/explore-silviculture-data-using-bcdata.html">Exploring Silviculture Data with bcdata</a>
    <a class="dropdown-item" href="../articles/local-filter.html">Update to `filter()` behaviour in bcdata v0.4.0</a>
    <a class="dropdown-item" href="../articles/service_documentation.html">bcdata Service Documentation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bcgov/bcdata/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Exploring Silviculture Data with bcdata</h1>
            
            <h4 data-toc-skip class="date">2022-10-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bcgov/bcdata/blob/HEAD/vignettes/explore-silviculture-data-using-bcdata.Rmd" class="external-link"><code>vignettes/explore-silviculture-data-using-bcdata.Rmd</code></a></small>
      <div class="d-none name"><code>explore-silviculture-data-using-bcdata.Rmd</code></div>
    </div>

    
    
<!--
Copyright 2019 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->
<p>This vignette will demonstrate how you can use <code>bcdata</code> to
access and explore British Columbia silviculture data.</p>
<div class="section level2">
<h2 id="silviculture-data">Silviculture Data<a class="anchor" aria-label="anchor" href="#silviculture-data"></a>
</h2>
<p>Silviculture data for British Columbia are largely collected and
stored through the <a href="https://www2.gov.bc.ca/gov/content?id=F62992DA5B324446AD5E1B5BFFA404CC" class="external-link">Reporting
Silviculture Updates and Land Status Tracking System (RESULTS)
database</a>—including information on the management of openings,
disturbances, silviculture activities and obligation declarations as
required by the <a href="https://www2.gov.bc.ca/gov/content?id=D65006C0326B4E0F838194044C10CA86" class="external-link">Forest
and Range Practices Act</a>. <a href="https://catalogue.data.gov.bc.ca/dataset?q=RESULTS+silviculture" class="external-link">RESULTS
data sets are publically available through the B.C. Data Catalogue</a>
under the <a href="https://www2.gov.bc.ca/gov/content?id=A519A56BC2BF44E4A008B33FCF527F61" class="external-link">Open
Government Licence - British Columbia</a>.</p>
</div>
<div class="section level2">
<h2 id="reforestation-with-climate-considerations">Reforestation with Climate Considerations<a class="anchor" aria-label="anchor" href="#reforestation-with-climate-considerations"></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Larix_occidentalis" class="external-link">Western
larch</a> has been identified as a tree species that will be
well-adapted to projected future climates in northern British Columbia.
In 2013, forest policy was developed that allowed foresters to plant
western larch outside of its natural range as a climate change
adaptation silviculture measure.</p>
<div class="section level4">
<h4 id="how-much-western-larch-has-been-planted-in-the-prince-george-natural-resource-district">How much western larch has been planted in the Prince George Natural
Resource District?<a class="anchor" aria-label="anchor" href="#how-much-western-larch-has-been-planted-in-the-prince-george-natural-resource-district"></a>
</h4>
<p>Let’s use the <code>bcdata</code> package to search, retrieve and
explore the RESULTS silviculture data and answer this question.</p>
</div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>To start, let’s load the <code>bcdata</code> package. We will also
load the <code>dplyr</code> and <code>ggplot2</code> packages to help us
work with the data. You can learn more about the <code>dplyr</code>
package <a href="https://dplyr.tidyverse.org/" class="external-link">here</a> and the
<code>ggplot2</code> package <a href="https://ggplot2.tidyverse.org/" class="external-link">here</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bcgov.github.io/bcdata/">bcdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-the-data">Getting the Data<a class="anchor" aria-label="anchor" href="#getting-the-data"></a>
</h2>
<p>We can gather the data we need to answer our question using the <a href="https://catalogue.data.gov.bc.ca/dataset/258bb088-4113-47b1-b568-ce20bd64e3e3" class="external-link">RESULTS
- silviculture forest cover dataset</a>. First, let’s take a look at the
metadata record using <code><a href="../reference/bcdc_get_record.html">bcdc_get_record()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the metadata using the human-readable record name</span></span>
<span><span class="fu"><a href="../reference/bcdc_get_record.html">bcdc_get_record</a></span><span class="op">(</span><span class="st">"results-forest-cover-silviculture"</span><span class="op">)</span></span>
<span><span class="co">#&gt; B.C. Data Catalogue Record: RESULTS - Forest Cover Silviculture</span></span>
<span><span class="co">#&gt; Name: results-forest-cover-silviculture (ID: 258bb088-4113-47b1-b568-ce20bd64e3e3)</span></span>
<span><span class="co">#&gt; Permalink: https://catalogue.data.gov.bc.ca/dataset/258bb088-4113-47b1-b568-ce20bd64e3e3</span></span>
<span><span class="co">#&gt; Licence: Open Government Licence - British Columbia</span></span>
<span><span class="co">#&gt; Description: RESULTS opening's forest cover poylgons with silviculture component</span></span>
<span><span class="co">#&gt;  provided.  Current forest cover subimssion into RESULTS must contain attribute and map</span></span>
<span><span class="co">#&gt;  information.  However, there are historical forest cover polygon infomration where maps</span></span>
<span><span class="co">#&gt;  are not available.  Forest Cover is provided at three critical milestones of at</span></span>
<span><span class="co">#&gt;  harvesting, at regeneration, and at free growing.  This is a part o fthe Silviculture</span></span>
<span><span class="co">#&gt;  and Land Status Tracking dataset, which includes tracking achievement of silviculture</span></span>
<span><span class="co">#&gt;  obligations on Crown Land</span></span>
<span><span class="co">#&gt; Available Resources (1):</span></span>
<span><span class="co">#&gt;  1. WMS getCapabilities request (wms)</span></span>
<span><span class="co">#&gt; Access the full 'Resources' data frame using:</span></span>
<span><span class="co">#&gt;  bcdc_tidy_resources('258bb088-4113-47b1-b568-ce20bd64e3e3')</span></span>
<span><span class="co">#&gt; Query and filter this data using:</span></span>
<span><span class="co">#&gt;  bcdc_query_geodata('258bb088-4113-47b1-b568-ce20bd64e3e3')</span></span></code></pre></div>
<p>We see that this is a <a href="https://en.wikipedia.org/wiki/Web_Feature_Service" class="external-link">Web Feature
Service-enabled</a> geospatial data set–the list of data resources
includes <code>WMS getCapabilities request</code>–so we can query and
retrieve this geospatial data set using
<code><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Query the data using the permanent ID of the record to guard against name changes</span></span>
<span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"258bb088-4113-47b1-b568-ce20bd64e3e3"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Querying 'results-forest-cover-silviculture' record</span></span>
<span><span class="co">#&gt; • Using collect() on this object will return 920718 features and 159 fields</span></span>
<span><span class="co">#&gt; • Accessing this record requires pagination and will make 921 separate requests to the WFS.</span></span>
<span><span class="co">#&gt; • See ?bcdc_options</span></span>
<span><span class="co">#&gt; • At most six rows of the record are printed here</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 159 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1184167 ymin: 526455.5 xmax: 1801754 ymax: 1083545</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / BC Albers</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 160</span></span>
<span><span class="co">#&gt;   id         FORES…¹ STOCK…² OPENI…³ STAND…⁴ SILV_…⁵ SILV_…⁶ SILV_…⁷ SILV_…⁸ STOCK…⁹ STOCK…˟ STOCK…˟</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 WHSE_FORE… 4177991 2243439 1724262 1       C           1.6     1.6       0 IMM     ART     &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; 2 WHSE_FORE… 3994007      NA 1248495 &lt;NA&gt;    91          1.2     1.2       0 MAT     NAT     &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; 3 WHSE_FORE… 3994067      NA 1120935 &lt;NA&gt;    86          0.6     0.6       0 MAT     NAT     &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; 4 WHSE_FORE… 3994009 1404558 1248495 A       AA         22.1    22.1       0 IMM     ART     &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; 5 WHSE_FORE… 3994057 1211894 1120935 B       2B         16.9    16.9       0 IMM     ART     &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; 6 WHSE_FORE… 3994063      NA 1120935 &lt;NA&gt;    82          0.1     0.1       0 MAT     NAT     &lt;NA&gt;   </span></span>
<span><span class="co">#&gt; # … with 148 more variables: SILV_RESERVE_CODE &lt;chr&gt;, SILV_RESERVE_OBJECTIVE_CODE &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   TREE_COVER_PATTERN_CODE &lt;chr&gt;, REENTRY_YEAR &lt;chr&gt;, REFERENCE_YEAR &lt;int&gt;, SITE_INDEX &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   SITE_INDEX_SOURCE_CODE &lt;chr&gt;, BGC_ZONE_CODE &lt;chr&gt;, BGC_SUBZONE_CODE &lt;chr&gt;, BGC_VARIANT &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   BGC_PHASE &lt;chr&gt;, BEC_SITE_SERIES &lt;chr&gt;, BEC_SITE_TYPE &lt;chr&gt;, BEC_SERAL &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   IS_SILV_IMPLIED_IND &lt;chr&gt;, FOREST_COVER_SILV_TYPE &lt;chr&gt;, S_FOREST_COVER_LAYER_ID &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   S_TOTAL_STEMS_PER_HA &lt;chr&gt;, S_TOTAL_WELL_SPACED_STEMS_HA &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   S_WELL_SPACED_STEMS_PER_HA &lt;int&gt;, S_FREE_GROWING_STEMS_PER_HA &lt;int&gt;, …</span></span></code></pre></div>
<p>This query shows that this data set has many features and over 150
fields. Each feature is a treatment unit within a harvested opening, and
contains information on the leading five tree species that are present
in each treatment unit, including stems per hectare, age, and
height.</p>
<p>Note that we have only <em>queried</em> the data set so far—the data
set would be too large (~1GB) to download efficiently. So, let’s use
<code><a href="../reference/filter.html">filter()</a></code> with <code><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata()</a></code> to refine
our query <em>before</em> we collect the data and import it into R.</p>
</div>
<div class="section level2">
<h2 id="refining-a-geospatial-data-query">Refining a Geospatial Data Query<a class="anchor" aria-label="anchor" href="#refining-a-geospatial-data-query"></a>
</h2>
<p>To address our question, we need the treatment data (1) from the
Prince George Natural Resource District <em>and</em> (2) that contain
western larch.</p>
<p>First, we can use the <code>bcdata</code> package to download the
spatial boundary for the Prince George Natural Resource
District—<code>DPG</code> is the <code>ORG_UNIT</code> for Prince George
Natural Resource District:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create a spatial feature object named dpg</span></span>
<span><span class="va">dpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"natural-resource-nr-district"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ORG_UNIT</span><span class="op">==</span><span class="st">"DPG"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># filter for Prince George Natural Resource District</span></span>
<span>  <span class="fu"><a href="../reference/collect-methods.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># and collect the data</span></span></code></pre></div>
<p>Let’s plot this spatial object and double check we have we what we
need:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dpg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette-fig-plot-dpg-1.png" alt="plot of chunk plot-dpg" width="100%"></p>
<p>Now we have a spatial object that we can use as a bounding box to
filter and download records in the RESULTS - silviculture layer from the
Prince George Natural Resource District.</p>
<p>We only need to download the treatments that have western larch
planted. We can use the <code><a href="../reference/bcdc_describe_feature.html">bcdc_describe_feature()</a></code> helper
function to examine the column names and types of the layer. In this
case, we want to keep rows where the five <code>S_SPECIES_CODE_*</code>
columns contain <code>"LW"</code>, the code for western larch.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a vector of tree species we are interested in</span></span>
<span><span class="co"># (in this case only LW for western larch)</span></span>
<span><span class="va">spp_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LW"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Query and filter the data layer</span></span>
<span><span class="va">trees_dpg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"258bb088-4113-47b1-b568-ce20bd64e3e3"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/cql_geom_predicates.html">INTERSECTS</a></span><span class="op">(</span><span class="va">dpg</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#filter for records that are within the DPG boundary</span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">S_SPECIES_CODE_1</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">spp_list</span> <span class="op">|</span>  <span class="co">#filter for LW records</span></span>
<span>      <span class="va">S_SPECIES_CODE_2</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">spp_list</span> <span class="op">|</span></span>
<span>      <span class="va">S_SPECIES_CODE_3</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">spp_list</span> <span class="op">|</span></span>
<span>      <span class="va">S_SPECIES_CODE_4</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">spp_list</span> <span class="op">|</span></span>
<span>      <span class="va">S_SPECIES_CODE_5</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">spp_list</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collect-methods.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#collect/download the data</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="exploring-the-data">Exploring the Data<a class="anchor" aria-label="anchor" href="#exploring-the-data"></a>
</h2>
<p>Let’s look at the dimensions of this now much more manageable data
object we have downloaded from the B.C. Data Catalogue:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">trees_dpg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 212 160</span></span></code></pre></div>
<p>We can see there are several treatment units planted with western
larch, and we can make a quick map of these harvested openings for the
Prince George Natural Resource District:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_dpg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dpg</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> <span class="co">#add the DPG spatial boundary</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette-fig-map-larch-plantations-dpg-1.png" alt="plot of chunk map-larch-plantations-dpg" width="100%"></p>
<p>We can also create some quick descriptive summaries of the data,
treating the geospatial attribute table as a data frame in R, and answer
our original question—how much western larch has been planted in the
Prince George Natural Resource District?</p>
<div class="section level4">
<h4 id="what-is-the-size-and-age-distribution-of-larch-plantations-in-the-prince-george-natural-resource-district-in-the-year-2020">What is the size and age distribution of larch plantations in the
Prince George Natural Resource District in the year 2020?<a class="anchor" aria-label="anchor" href="#what-is-the-size-and-age-distribution-of-larch-plantations-in-the-prince-george-natural-resource-district-in-the-year-2020"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_dpg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">2020</span> <span class="op">-</span> <span class="va">REFERENCE_YEAR</span> <span class="op">+</span> <span class="va">S_SPECIES_AGE_1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#create a plantation age column</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="co">#start a plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">FEATURE_AREA_SQM</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span> <span class="op">+</span> <span class="co">#convert feature area to hectares</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"sum"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Stand Age (years)"</span>,</span>
<span>                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">5</span>, to <span class="op">=</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Sum Treatment Unit Area (ha)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Area Planted with Western Larch by Stand Age\nin Prince George Natural Resource District"</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Data sourced from the B.C. Data Catalogue\n on "</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        <span class="st">" using the bcdata R package"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" width="100%"></p>
</div>
<div class="section level4">
<h4 id="what-is-the-biogeoclimatic-ecosystem-classification-bec-distribution-of-western-larch-plantations-in-the-prince-george-natural-resource-district">What is the Biogeoclimatic Ecosystem Classification (BEC)
distribution of western larch plantations in the Prince George Natural
Resource District?<a class="anchor" aria-label="anchor" href="#what-is-the-biogeoclimatic-ecosystem-classification-bec-distribution-of-western-larch-plantations-in-the-prince-george-natural-resource-district"></a>
</h4>
<p>We can download <a href="https://catalogue.data.gov.bc.ca/dataset/bec-map" class="external-link">British Columbia
biogeoclimatic (BEC) data</a> from the B.C. Data Catalogue using
<code>bcdata</code> and join to our existing <code>trees_dpg</code>
geospatial dataset using the <code>st_join</code> function from the
<code>sf</code> package. You can learn more about <code>sf</code> <a href="https://r-spatial.github.io/sf/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> <span class="co">#load the sf package</span></span>
<span></span>
<span><span class="co"># Load the BEC data for Prince George Natural Resource District</span></span>
<span><span class="co"># Load the BEC data for Prince George Natural Resource District</span></span>
<span><span class="va">bgc_dpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"WHSE_FOREST_VEGETATION.BEC_BIOGEOCLIMATIC_POLY"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/cql_geom_predicates.html">BBOX</a></span><span class="op">(</span><span class="va">dpg</span>, crs <span class="op">=</span> <span class="st">"EPSG:3005"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#note filtering with a BoundingBox</span></span>
<span>  <span class="fu"><a href="../reference/collect-methods.html">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join the BEC data with our tress_dpg geospatial data set</span></span>
<span><span class="va">trees_bec_dpg</span> <span class="op">&lt;-</span> <span class="va">trees_dpg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">bgc_dpg</span><span class="op">[</span>, <span class="st">"MAP_LABEL"</span><span class="op">]</span><span class="op">)</span> <span class="co">#join BEC data for each polygon</span></span></code></pre></div>
<p>Now, we can summarize the area planted with western larch by
biogeoclimatic unit:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_bec_dpg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">MAP_LABEL</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># group polygons by biogeoclimatic unit</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>Area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">FEATURE_AREA_SQM</span><span class="op">)</span><span class="op">/</span><span class="fl">10000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">MAP_LABEL</span>, y <span class="op">=</span> <span class="va">Area</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Sum Treatment Unit Area (ha)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Biogeoclimatic Unit"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Area Planted with Western Larch by Biogeoclimatic Unit\nin Prince George Natural Resource District"</span>,</span>
<span>       caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Data sourced from the B.C. Data Catalogue\n on "</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        <span class="st">" using the bcdata R package"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette-fig-unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andy Teucher, Sam Albers, Stephanie Hazlitt.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
