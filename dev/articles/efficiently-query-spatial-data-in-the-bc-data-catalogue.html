<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Querying Spatial Data with bcdata • bcdata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Querying Spatial Data with bcdata">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bcdata</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.4.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bcdata.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/efficiently-query-spatial-data-in-the-bc-data-catalogue.html">Querying Spatial Data with bcdata</a></li>
    <li><a class="dropdown-item" href="../articles/explore-silviculture-data-using-bcdata.html">Exploring Silviculture Data with bcdata</a></li>
    <li><a class="dropdown-item" href="../articles/local-filter.html">Update to `filter()` behaviour in bcdata v0.4.0</a></li>
    <li><a class="dropdown-item" href="../articles/service_documentation.html">bcdata Service Documentation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bcgov/bcdata/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Querying Spatial Data with bcdata</h1>
            
            <h4 data-toc-skip class="date">2024-12-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bcgov/bcdata/blob/main/vignettes/efficiently-query-spatial-data-in-the-bc-data-catalogue.Rmd" class="external-link"><code>vignettes/efficiently-query-spatial-data-in-the-bc-data-catalogue.Rmd</code></a></small>
      <div class="d-none name"><code>efficiently-query-spatial-data-in-the-bc-data-catalogue.Rmd</code></div>
    </div>

    
    
<!--
Copyright 2019 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->
<p>This vignette illustrates how to use
<code><a href="../reference/bcdc_query_geodata.html">bcdata::bcdc_query_geodata</a></code> to request and query geospatial
data that has an associated <a href="https://en.wikipedia.org/wiki/Web_Feature_Service" class="external-link">Web Feature
Service</a> from the <a href="https://catalogue.data.gov.bc.ca/dataset" class="external-link">B.C. Data Catalogue</a>.
To illustrate, we will request and merge two spatial data sets from the
catalogue—school district and greenspaces spatial data—and then examine
the amount of park space contained within the boundaries of the Greater
Victoria, Prince George and Kamloops/Thompson British Columbia school
districts.</p>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>First you need to load the package. We will also load the
<code>sf</code> and <code>dplyr</code> packages to help us work with
spatial data. You can learn more about the <code>sf</code> package <a href="https://r-spatial.github.io/sf/" class="external-link">here</a> and <code>dplyr</code>
<a href="https://dplyr.tidyverse.org/" class="external-link">here</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bcgov.github.io/bcdata/">bcdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="geospatial-data-in-the-b-c--data-catalogue">Geospatial Data in the B.C. Data Catalogue<a class="anchor" aria-label="anchor" href="#geospatial-data-in-the-b-c--data-catalogue"></a>
</h2>
<p>The <a href="https://catalogue.data.gov.bc.ca/dataset" class="external-link">B.C. Data
Catalogue</a> provides many data sets with spatial information through a
<a href="https://en.wikipedia.org/wiki/Web_Feature_Service" class="external-link">Web Feature
Service (WFS)</a>. Technically speaking, this means if we have an
internet connection we can issue <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol" class="external-link">HTTP</a>
requests to the catalogue and seamlessly import the response data into R
as an <code>sf</code> objects. The <code>bcdata</code> package provides
a means to a) choose which layer you want and b) use <code>dplyr</code>
verbs to specifically tailor your request. A <code>dbplyr</code> backend
is implemented so that requests are executed lazily meaning results are
not transferred over the web until the user specifically calls the
<code>collect</code> function. This approach mimics the
<code>dplyr</code> verb translation to <code>SQL</code> seen for many
database types. A good introduction to principles of <code>dbplyr</code>
is available <a href="https://cran.r-project.org/package=dbplyr/vignettes/dbplyr.html" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="school-district-data">School District Data<a class="anchor" aria-label="anchor" href="#school-district-data"></a>
</h2>
<p>Our first step is to extract the <a href="https://catalog.data.gov.bc.ca/dataset/78ec5279-4534-49a1-97e8-9d315936f08b" class="external-link">school
district polygons</a> from the B.C. Data Catalogue. This layer is
described using this command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_get_record.html">bcdc_get_record</a></span><span class="op">(</span><span class="st">"78ec5279-4534-49a1-97e8-9d315936f08b"</span><span class="op">)</span></span>
<span><span class="co">#&gt; B.C. Data Catalogue Record: School Districts of BC</span></span>
<span><span class="co">#&gt; Name: school-districts-of-bc (ID: 78ec5279-4534-49a1-97e8-9d315936f08b)</span></span>
<span><span class="co">#&gt; Permalink: https://catalogue.data.gov.bc.ca/dataset/78ec5279-4534-49a1-97e8-9d315936f08b</span></span>
<span><span class="co">#&gt; Licence: Open Government Licence - British Columbia</span></span>
<span><span class="co">#&gt; Description: The School Districts dataset contains the spatial representation (polygon)</span></span>
<span><span class="co">#&gt;  of the current extent of the administrative areas defined under section 176(1) of the</span></span>
<span><span class="co">#&gt;  School Act for the purposes of preservation and promotion of the fundamental principle</span></span>
<span><span class="co">#&gt;  of local autonomy and control of public education at the public and governmental levels</span></span>
<span><span class="co">#&gt;  through locally elected school boards.</span></span>
<span><span class="co">#&gt; Available Resources (1):</span></span>
<span><span class="co">#&gt;  1. WMS getCapabilities request (wms)</span></span>
<span><span class="co">#&gt; Access the full 'Resources' data frame using:</span></span>
<span><span class="co">#&gt;  bcdc_tidy_resources('78ec5279-4534-49a1-97e8-9d315936f08b')</span></span>
<span><span class="co">#&gt; Query and filter this data using:</span></span>
<span><span class="co">#&gt;  bcdc_query_geodata('78ec5279-4534-49a1-97e8-9d315936f08b')</span></span></code></pre></div>
<p>This data is the boundary of each school district. The key
information in this metadata is that the layer has a resource in
<code>"wms"</code> format —which means it is available through a Web
Feature Service. From this we know we can make use of
<code>bcdc_query_geodata</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"78ec5279-4534-49a1-97e8-9d315936f08b"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Querying 'school-districts-of-bc' record</span></span>
<span><span class="co">#&gt; • Using collect() on this object will return 59 features and 9 fields</span></span>
<span><span class="co">#&gt; • At most six rows of the record are printed here</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 9 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 956376 ymin: 475108.4 xmax: 1635228 ymax: 901924.4</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / BC Albers</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 10</span></span>
<span><span class="co">#&gt;   id        ADMIN_AREA_SID SCHOOL_DISTRICT_NAME SCHOOL_DISTRICT_NUMBER FEATURE_CODE FEATURE_AREA_SQM</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;                                 &lt;int&gt; &lt;chr&gt;                   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 WHSE_TAN…            300 Arrow Lakes                              10 FH10000300        7392472526.</span></span>
<span><span class="co">#&gt; 2 WHSE_TAN…            301 Revelstoke                               19 FH10000300        9416076465.</span></span>
<span><span class="co">#&gt; 3 WHSE_TAN…            302 Kootenay-Columbia                        20 FH10000300        3072672101.</span></span>
<span><span class="co">#&gt; 4 WHSE_TAN…            303 Vernon                                   22 FH10000300        5588468673.</span></span>
<span><span class="co">#&gt; 5 WHSE_TAN…            304 Central Okanagan                         23 FH10000300        2916757936.</span></span>
<span><span class="co">#&gt; 6 WHSE_TAN…            305 Cariboo-Chilcotin                        27 FH10000300       61213520885.</span></span>
<span><span class="co">#&gt; # ℹ 4 more variables: FEATURE_LENGTH_M &lt;dbl&gt;, OBJECTID &lt;int&gt;, SE_ANNO_CAD_DATA &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   geometry &lt;POLYGON [m]&gt;</span></span></code></pre></div>
<p>This is the initial query to the data in the catalogue. What has been
returned is <em>not</em> the actual data but rather a subset to help you
tune your query. The printed output of this query offers several useful
pieces of information. Because we have queried with a unique ID, we are
shown the name of the record. We also receive instruction that using
<code><a href="../reference/collect-methods.html">collect()</a></code> will retrieve a given number of features and
fields present for this query. Lastly, there is a reminder that what is
printed is only the first 6 rows of the record. Since we are limiting
the scope of analysis to the Greater Victoria, Prince George and
Kamloops/Thompson school districts, we want to ask the catalogue for
only those polygons just like we would in a typical <code>dplyr</code>
workflow:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"78ec5279-4534-49a1-97e8-9d315936f08b"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SCHOOL_DISTRICT_NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater Victoria"</span>, <span class="st">"Prince George"</span>,<span class="st">"Kamloops/Thompson"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Querying 'school-districts-of-bc' record</span></span>
<span><span class="co">#&gt; • Using collect() on this object will return 1 features and 9 fields</span></span>
<span><span class="co">#&gt; • At most six rows of the record are printed here</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 9 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1126789 ymin: 821142.1 xmax: 1528155 ymax: 1224202</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / BC Albers</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 10</span></span>
<span><span class="co">#&gt;   id        ADMIN_AREA_SID SCHOOL_DISTRICT_NAME SCHOOL_DISTRICT_NUMBER FEATURE_CODE FEATURE_AREA_SQM</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;                                 &lt;int&gt; &lt;chr&gt;                   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 WHSE_TAN…            328 Prince George                            57 FH10000300       51888780641.</span></span>
<span><span class="co">#&gt; # ℹ 4 more variables: FEATURE_LENGTH_M &lt;dbl&gt;, OBJECTID &lt;int&gt;, SE_ANNO_CAD_DATA &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   geometry &lt;POLYGON [m]&gt;</span></span></code></pre></div>
<p>To further tune our query, we can also request only the columns we
want. Really we only want the school district column and the spatial
information. During an actual analysis, it is possible that you may need
to initially collect more data than you want to determine value to
subset by. For example, there is currently no way to ask the catalogue
for all possible unique values of <code>SCHOOL_DISTRICT_NAME</code>. Is
that case the data will need to be brought into R and unique values will
need to be determined there.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"78ec5279-4534-49a1-97e8-9d315936f08b"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SCHOOL_DISTRICT_NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater Victoria"</span>, <span class="st">"Prince George"</span>,<span class="st">"Kamloops/Thompson"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select.html">select</a></span><span class="op">(</span><span class="va">SCHOOL_DISTRICT_NAME</span><span class="op">)</span></span>
<span><span class="co">#&gt; Querying 'school-districts-of-bc' record</span></span>
<span><span class="co">#&gt; • Using collect() on this object will return 1 features and 5 fields</span></span>
<span><span class="co">#&gt; • At most six rows of the record are printed here</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1126789 ymin: 821142.1 xmax: 1528155 ymax: 1224202</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / BC Albers</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span><span class="co">#&gt;   id                             ADMIN_AREA_SID SCHOOL_DISTRICT_NAME SCHOOL_DISTRICT_NUMBER OBJECTID</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                   &lt;int&gt; &lt;chr&gt;                                 &lt;int&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 WHSE_TANTALIS.TA_SCHOOL_DISTR…            328 Prince George                            57      562</span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: geometry &lt;POLYGON [m]&gt;</span></span></code></pre></div>
<p>Note that in the <code>select</code> statement, we did not explicitly
ask for the spatial data and also that there are several columns present
that we didn’t select. This is because within each data set in the data
catalogue, there are several columns that will always be returned
regardless of what is selected. If you really don’t want those columns
after you <code>collect</code> the data, which we will take care of
right now, you can drop them:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">districts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"78ec5279-4534-49a1-97e8-9d315936f08b"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">SCHOOL_DISTRICT_NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater Victoria"</span>, <span class="st">"Prince George"</span>,<span class="st">"Kamloops/Thompson"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select.html">select</a></span><span class="op">(</span><span class="va">SCHOOL_DISTRICT_NAME</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collect-methods.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Again note here that we have assigned the object a name and added the
<code>collect</code> statement. This step happens when you have selected
the data you want and wish to begin working with it in R like a normal
<code>sf</code> object. For example, we can now plot these three school
districts:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">districts</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="vignette-fig-districts-1.png" alt="plot of chunk districts" width="100%"><p class="caption">
plot of chunk districts
</p>
</div>
<p>Now that we have the spatial boundaries narrowed by specific school
districts we can perform some spatial operations to determine parks in
the school districts.</p>
</div>
<div class="section level2">
<h2 id="greenspaces-data">Greenspaces Data<a class="anchor" aria-label="anchor" href="#greenspaces-data"></a>
</h2>
<p>For the purposes of this example, let’s consider <a href="https://catalogue.data.gov.bc.ca/dataset/6a2fea1b-0cc4-4fc2-8017-eaf755d516da" class="external-link">this
greenspace</a> layer in the catalogue. This layer is described here:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_get_record.html">bcdc_get_record</a></span><span class="op">(</span><span class="st">"6a2fea1b-0cc4-4fc2-8017-eaf755d516da"</span><span class="op">)</span></span>
<span><span class="co">#&gt; B.C. Data Catalogue Record: Local and Regional Greenspaces</span></span>
<span><span class="co">#&gt; Name: local-and-regional-greenspaces (ID: 6a2fea1b-0cc4-4fc2-8017-eaf755d516da)</span></span>
<span><span class="co">#&gt; Permalink: https://catalogue.data.gov.bc.ca/dataset/6a2fea1b-0cc4-4fc2-8017-eaf755d516da</span></span>
<span><span class="co">#&gt; Licence: Open Government Licence - British Columbia</span></span>
<span><span class="co">#&gt; Description: This dataset contains spatial and attribute information for local and</span></span>
<span><span class="co">#&gt;  regional greenspaces in British Columbia. Local and regional greenspaces are municipal</span></span>
<span><span class="co">#&gt;  or regional district lands designated by local government agencies and managed for</span></span>
<span><span class="co">#&gt;  public enjoyment, ecosystem or wildlife values. Spatial boundaries were sourced from</span></span>
<span><span class="co">#&gt;  municipal and regional district web sites, which in some cases provide datasets under</span></span>
<span><span class="co">#&gt;  Open Government Licence, and in other cases, publicize parks and greenspaces on web maps</span></span>
<span><span class="co">#&gt;  or pdf maps. Boundaries were edge-matched to the ParcelMap BC cadastre.  This spatial</span></span>
<span><span class="co">#&gt;  layer contains multipart polygons.</span></span>
<span><span class="co">#&gt; Available Resources (2):</span></span>
<span><span class="co">#&gt;  1. WMS getCapabilities request (wms)</span></span>
<span><span class="co">#&gt;  2. LocalRegionalParksAttributeValues (xlsx)</span></span>
<span><span class="co">#&gt; Access the full 'Resources' data frame using:</span></span>
<span><span class="co">#&gt;  bcdc_tidy_resources('6a2fea1b-0cc4-4fc2-8017-eaf755d516da')</span></span>
<span><span class="co">#&gt; Query and filter this data using:</span></span>
<span><span class="co">#&gt;  bcdc_query_geodata('6a2fea1b-0cc4-4fc2-8017-eaf755d516da')</span></span></code></pre></div>
<p>Again we recognize this is <a href="https://en.wikipedia.org/wiki/Web_Feature_Service" class="external-link">WFS-enabled</a>
geospatial data, which means we can make use of
<code>bcdc_query_geodata</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"6a2fea1b-0cc4-4fc2-8017-eaf755d516da"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Querying 'local-and-regional-greenspaces' record</span></span>
<span><span class="co">#&gt; • Using collect() on this object will return 9143 features and 19 fields</span></span>
<span><span class="co">#&gt; • At most six rows of the record are printed here</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 19 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1205812 ymin: 461894.2 xmax: 1210343 ymax: 463217.4</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / BC Albers</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 20</span></span>
<span><span class="co">#&gt;   id      LOCAL_REG_GREENSPACE…¹ PARK_NAME PARK_TYPE PARK_PRIMARY_USE REGIONAL_DISTRICT MUNICIPALITY</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                    &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1 WHSE_B…                     40 Wowk Nei… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 2 WHSE_B…                     41 Hugh Boy… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 3 WHSE_B…                     42 Sandifor… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 4 WHSE_B…                     43 Kozier N… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 5 WHSE_B…                     44 Maple La… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 6 WHSE_B…                     45 South Ar… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; # ℹ abbreviated name: ¹​LOCAL_REG_GREENSPACE_ID</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: CIVIC_NUMBER &lt;int&gt;, CIVIC_NUMBER_SUFFIX &lt;chr&gt;, STREET_NAME &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   LATITUDE &lt;dbl&gt;, LONGITUDE &lt;dbl&gt;, WHEN_UPDATED &lt;date&gt;, WEBSITE_URL &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   LICENCE_COMMENTS &lt;chr&gt;, FEATURE_AREA_SQM &lt;dbl&gt;, FEATURE_LENGTH_M &lt;dbl&gt;, OBJECTID &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   SE_ANNO_CAD_DATA &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;</span></span></code></pre></div>
<p>Since we are interested in only “Park” data we can subset our
query:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"6a2fea1b-0cc4-4fc2-8017-eaf755d516da"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARK_PRIMARY_USE</span> <span class="op">==</span> <span class="st">"Park"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Querying 'local-and-regional-greenspaces' record</span></span>
<span><span class="co">#&gt; • Using collect() on this object will return 4517 features and 19 fields</span></span>
<span><span class="co">#&gt; • At most six rows of the record are printed here</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 19 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1205812 ymin: 461894.2 xmax: 1210343 ymax: 463217.4</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / BC Albers</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 20</span></span>
<span><span class="co">#&gt;   id      LOCAL_REG_GREENSPACE…¹ PARK_NAME PARK_TYPE PARK_PRIMARY_USE REGIONAL_DISTRICT MUNICIPALITY</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                    &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1 WHSE_B…                     40 Wowk Nei… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 2 WHSE_B…                     41 Hugh Boy… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 3 WHSE_B…                     42 Sandifor… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 4 WHSE_B…                     43 Kozier N… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 5 WHSE_B…                     44 Maple La… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; 6 WHSE_B…                     45 South Ar… Local     Park             Metro Vancouver   Richmond    </span></span>
<span><span class="co">#&gt; # ℹ abbreviated name: ¹​LOCAL_REG_GREENSPACE_ID</span></span>
<span><span class="co">#&gt; # ℹ 13 more variables: CIVIC_NUMBER &lt;int&gt;, CIVIC_NUMBER_SUFFIX &lt;chr&gt;, STREET_NAME &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   LATITUDE &lt;dbl&gt;, LONGITUDE &lt;dbl&gt;, WHEN_UPDATED &lt;date&gt;, WEBSITE_URL &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   LICENCE_COMMENTS &lt;chr&gt;, FEATURE_AREA_SQM &lt;dbl&gt;, FEATURE_LENGTH_M &lt;dbl&gt;, OBJECTID &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   SE_ANNO_CAD_DATA &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;</span></span></code></pre></div>
<p>Here we see that this greatly reduces the number of features that we
are dealing with (and correspondingly the amount of data that needs to
be transferred over the web). Remember also that we still have not
actually requested the full data set. This is just still a preview. Also
this query still includes all municipal parks in BC while we only want
the ones in the three school districts - the polygons defined by the
<code>districts</code> object. To find that subset of parks we can make
use of the built-in geometric operators which allow us to perform
spatial operations remotely fine tuning our query even further. Here
using the <code>INTERSECTS</code> function is appropriate and since this
is a last tuning step, we can call <code>collect</code> and assign a
name to this object. These requests can sometimes take quite a long:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">districts_parks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"6a2fea1b-0cc4-4fc2-8017-eaf755d516da"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARK_PRIMARY_USE</span> <span class="op">==</span> <span class="st">"Park"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/cql_geom_predicates.html">INTERSECTS</a></span><span class="op">(</span><span class="va">districts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collect-methods.html">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; The object is too large to perform exact spatial operations using bcdata.</span></span>
<span><span class="co">#&gt; Object size: 948576 bytes</span></span>
<span><span class="co">#&gt; BC Data Threshold: 500000 bytes</span></span>
<span><span class="co">#&gt; Exceedance: 448576 bytes</span></span>
<span><span class="co">#&gt; See ?bcdc_check_geom_size for more details</span></span>
<span><span class="co">#&gt; A bounding box was drawn around the object passed to INTERSECTS and all features within the box will be returned.</span></span></code></pre></div>
<p>Plotting both the filtered parks data and the district polygons
reveals an important consideration when using <code>bcdata</code>:</p>
<div class="figure">
<img src="vignette-fig-district_parks-1.png" alt="plot of chunk district_parks" width="100%"><p class="caption">
plot of chunk district_parks
</p>
</div>
<p>In this example, many parks not contained within the school districts
are included in the <code>districts_parks</code> object. This is because
rather than a full intersection, <code>bcdata</code> draws a bounding
box around all the polygons that are doing the intersection (in this
case <code>district</code>) and does the intersection based on that
bounding box. This behaviour is imposed by the Web Feature Server but
controlled via the <code>bcdata.max_geom_pred_size</code> option (See
<code><a href="../reference/bcdc_options.html">?bcdc_options</a></code> for default values). Using this example, you
can check to see if the size of the <code>districts</code> object
exceeded the current value of
<code>bcdata.max_geom_pred_size</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_check_geom_size.html">bcdc_check_geom_size</a></span><span class="op">(</span><span class="va">districts</span><span class="op">)</span></span>
<span><span class="co">#&gt; The object is too large to perform exact spatial operations using bcdata.</span></span>
<span><span class="co">#&gt; Object size: 948576 bytes</span></span>
<span><span class="co">#&gt; BC Data Threshold: 500000 bytes</span></span>
<span><span class="co">#&gt; Exceedance: 448576 bytes</span></span>
<span><span class="co">#&gt; See ?bcdc_check_geom_size for more details</span></span></code></pre></div>
<p>Drawing the bounding box illustrates this point:</p>
<div class="figure">
<img src="vignette-fig-bbox-1.png" alt="plot of chunk bbox" width="100%"><p class="caption">
plot of chunk bbox
</p>
</div>
<p>We are left with two options to get around this problem. First, we
can simply do some additional processing with the <code>sf</code>
package. Specifically we can use a spatial join to assign parks into
their respective district:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">districts_parks_join</span> <span class="op">&lt;-</span> <span class="va">districts_parks</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">districts</span>, left <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="vignette-fig-dp_join-1.png" alt="plot of chunk dp_join" width="100%"><p class="caption">
plot of chunk dp_join
</p>
</div>
<p>A second approach is to set an internal option
(<code>bcdata.max_geom_pred_size</code>) and increase the threshold of
when a bounding box is drawn. Options are set in R like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"bcdata.max_geom_pred_size"</span> <span class="ot">=</span> {object size <span class="cf">in</span> bytes})</span></code></pre></div>
<p>The value of <code>bcdata.max_geom_pred_size</code> is set
conservatively so that requests to the Web Feature Service are more
consistently successful. Increasing this value may result in invalid
requests.</p>
<p>Finally, to address our original question of which school district
has the most municipal park space we can calculate the area of each park
polygon and then sum those areas by school district:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">districts_parks_join</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/mutate.html">mutate</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SCHOOL_DISTRICT_NAME</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">total_area</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 2</span></span>
<span><span class="co">#&gt;   SCHOOL_DISTRICT_NAME total_area</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                     [m^2]</span></span>
<span><span class="co">#&gt; 1 Prince George         11793481.</span></span></code></pre></div>
<div class="section level3">
<h3 id="a-note-about-using-local-r-functions-in-constructing-filter-queries">A note about using local R functions in constructing filter
queries<a class="anchor" aria-label="anchor" href="#a-note-about-using-local-r-functions-in-constructing-filter-queries"></a>
</h3>
<p>Suppose we now want to find all of the parks within 1km of the school
districts we are interested in. We can use <code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">sf::st_buffer()</a></code>
to make a buffer around the <code>districts</code> object, then
intersect that with the greenspaces data. Note that
<code><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer()</a></code> needs to be executed in R on our computer, to
create the buffered area that is sent to the WFS server to perform the
<code>INTERSECT</code> query remotely. We tell <code><a href="../reference/filter.html">filter()</a></code> to
evaluate that piece of code locally by wrapping it in a
<code><a href="https://rdrr.io/r/base/eval.html" class="external-link">local()</a></code> call:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">greenspaces_around</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"6a2fea1b-0cc4-4fc2-8017-eaf755d516da"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/cql_geom_predicates.html">INTERSECTS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">local</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">districts</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/collect-methods.html">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="additional-useful-functions">Additional Useful Functions<a class="anchor" aria-label="anchor" href="#additional-useful-functions"></a>
</h2>
<p>There are a couple of other functions in <code>bcdata</code> that are
useful to know when working with spatial data from the catalogue.
<code>bcdc_describe_feature</code> gives the column names, whether the
column is selectable, and the column types in both R and on the remote
server:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_describe_feature.html">bcdc_describe_feature</a></span><span class="op">(</span><span class="st">"6a2fea1b-0cc4-4fc2-8017-eaf755d516da"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 20 × 5</span></span>
<span><span class="co">#&gt;    col_name                sticky remote_col_type          local_col_type column_comments           </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                   &lt;lgl&gt;  &lt;chr&gt;                    &lt;chr&gt;          &lt;chr&gt;                     </span></span>
<span><span class="co">#&gt;  1 id                      TRUE   xsd:string               character      &lt;NA&gt;                      </span></span>
<span><span class="co">#&gt;  2 LOCAL_REG_GREENSPACE_ID TRUE   xsd:decimal              numeric        LOCAL_REG_GREENSPACE_ID i…</span></span>
<span><span class="co">#&gt;  3 PARK_NAME               FALSE  xsd:string               character      PARK NAME is the name of …</span></span>
<span><span class="co">#&gt;  4 PARK_TYPE               FALSE  xsd:string               character      PARK_TYPE is the type of …</span></span>
<span><span class="co">#&gt;  5 PARK_PRIMARY_USE        FALSE  xsd:string               character      PARK PRIMARY USE defines …</span></span>
<span><span class="co">#&gt;  6 REGIONAL_DISTRICT       FALSE  xsd:string               character      REGIONAL_DISTRICT is the …</span></span>
<span><span class="co">#&gt;  7 MUNICIPALITY            FALSE  xsd:string               character      MUNICIPALITY is the name …</span></span>
<span><span class="co">#&gt;  8 CIVIC_NUMBER            FALSE  xsd:decimal              numeric        CIVIC_NUMBER is the stree…</span></span>
<span><span class="co">#&gt;  9 CIVIC_NUMBER_SUFFIX     FALSE  xsd:string               character      CIVIC_NUMBER_SUFFIX is th…</span></span>
<span><span class="co">#&gt; 10 STREET_NAME             FALSE  xsd:string               character      STREET_NAME is the name o…</span></span>
<span><span class="co">#&gt; 11 LATITUDE                FALSE  xsd:decimal              numeric        LATITUDE is the geographi…</span></span>
<span><span class="co">#&gt; 12 LONGITUDE               FALSE  xsd:decimal              numeric        LONGITUDE is the geograph…</span></span>
<span><span class="co">#&gt; 13 WHEN_UPDATED            FALSE  xsd:date                 date           WHEN_UPDATED is the date …</span></span>
<span><span class="co">#&gt; 14 WEBSITE_URL             FALSE  xsd:string               character      WEBSITE_URL contains a li…</span></span>
<span><span class="co">#&gt; 15 LICENCE_COMMENTS        FALSE  xsd:string               character      LICENCE_COMMENTS describe…</span></span>
<span><span class="co">#&gt; 16 FEATURE_AREA_SQM        FALSE  xsd:decimal              numeric        FEATURE_AREA_SQM is the s…</span></span>
<span><span class="co">#&gt; 17 FEATURE_LENGTH_M        FALSE  xsd:decimal              numeric        FEATURE_LENGTH_M is the s…</span></span>
<span><span class="co">#&gt; 18 SHAPE                   FALSE  gml:GeometryPropertyType sfc geometry   SHAPE is the column used …</span></span>
<span><span class="co">#&gt; 19 OBJECTID                TRUE   xsd:decimal              numeric        OBJECTID is a column requ…</span></span>
<span><span class="co">#&gt; 20 SE_ANNO_CAD_DATA        FALSE  xsd:hexBinary            numeric        SE_ANNO_CAD_DATA is a bin…</span></span></code></pre></div>
<p>This is a helpful initial step to learn column names and types when
you construct your query.</p>
<p>Another useful function is <code><a href="../reference/show_query.html">show_query()</a></code> which provides
information on the request issued to the remote server:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"6a2fea1b-0cc4-4fc2-8017-eaf755d516da"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PARK_PRIMARY_USE</span> <span class="op">==</span> <span class="st">"Park"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="../reference/cql_geom_predicates.html">INTERSECTS</a></span><span class="op">(</span><span class="va">districts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/show_query.html">show_query</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;url&gt;</span></span>
<span><span class="co">#&gt; &lt;body&gt;</span></span>
<span><span class="co">#&gt; SERVICE: WFS VERSION: 2.0.0 REQUEST: GetFeature outputFormat: application/json typeNames:</span></span>
<span><span class="co">#&gt;  WHSE_BASEMAPPING.GBA_LOCAL_REG_GREENSPACES_SP SRSNAME: EPSG:3005 CQL_FILTER:</span></span>
<span><span class="co">#&gt;  (("PARK_PRIMARY_USE" = 'Park') AND (INTERSECTS(SHAPE, POLYGON ((1126789 821142.1,</span></span>
<span><span class="co">#&gt;  1528155 821142.1, 1528155 1224202, 1126789 1224202, 1126789 821142.1)))))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &lt;full query url&gt;</span></span>
<span><span class="co">#&gt; https://openmaps.gov.bc.ca/geo/pub/wfs?SERVICE=WFS&amp;VERSION=2.0.0&amp;REQUEST=GetFeature&amp;outputFormat=application%2Fjson&amp;typeNames=WHSE_BASEMAPPING.GBA_LOCAL_REG_GREENSPACES_SP&amp;SRSNAME=EPSG%3A3005&amp;CQL_FILTER=%28%28%22PARK_PRIMARY_USE%22%20%3D%20%27Park%27%29%20AND%20%28INTERSECTS%28SHAPE%2C%20POLYGON%20%28%281126789%20821142.1%2C%201528155%20821142.1%2C%201528155%201224202%2C%201126789%201224202%2C%201126789%20821142.1%29%29%29%29%29</span></span></code></pre></div>
<p>This output is what being created by the dplyr code outlined
above.</p>
</div>
<div class="section level2">
<h2 id="using-b-c--geographic-warehouse-bcgw-layer-names">Using B.C. Geographic Warehouse (BCGW) layer names<a class="anchor" aria-label="anchor" href="#using-b-c--geographic-warehouse-bcgw-layer-names"></a>
</h2>
<p>If you are familiar with the <a href="https://www2.gov.bc.ca/gov/content/data/finding-and-sharing/bc-geographic-warehouse" class="external-link">B.C.
Geographic Warehouse (BCGW)</a>, you may already know the name of a
layer that you want from the BCGW. <code><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata()</a></code> (as
well as all other related functions) supports supplying that name
directly. For example, the <a href="https://catalogue.data.gov.bc.ca/dataset/bc-airports#object-description" class="external-link">record
for the B.C. airports layer</a> shows that the object name is
<code>WHSE_IMAGERY_AND_BASE_MAPS.GSR_AIRPORTS_SVW</code>, and we can use
that in <code><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at the columns available:</span></span>
<span><span class="fu"><a href="../reference/bcdc_describe_feature.html">bcdc_describe_feature</a></span><span class="op">(</span><span class="st">"WHSE_IMAGERY_AND_BASE_MAPS.GSR_AIRPORTS_SVW"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 42 × 5</span></span>
<span><span class="co">#&gt;    col_name                      sticky remote_col_type local_col_type column_comments              </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                         &lt;lgl&gt;  &lt;chr&gt;           &lt;chr&gt;          &lt;chr&gt;                        </span></span>
<span><span class="co">#&gt;  1 id                            TRUE   xsd:string      character      &lt;NA&gt;                         </span></span>
<span><span class="co">#&gt;  2 CUSTODIAN_ORG_DESCRIPTION     TRUE   xsd:string      character      CUSTODIAN_ORG_DESCRIPTION co…</span></span>
<span><span class="co">#&gt;  3 BUSINESS_CATEGORY_CLASS       TRUE   xsd:string      character      BUSINESS_CATEGORY_CLASS desi…</span></span>
<span><span class="co">#&gt;  4 BUSINESS_CATEGORY_DESCRIPTION TRUE   xsd:string      character      BUSINESS_CATEGORY_DESCRIPTIO…</span></span>
<span><span class="co">#&gt;  5 OCCUPANT_TYPE_DESCRIPTION     TRUE   xsd:string      character      OCCUPANT_TYPE_DESCRIPTION co…</span></span>
<span><span class="co">#&gt;  6 SOURCE_DATA_ID                TRUE   xsd:string      character      SOURCE_DATA_ID is a unique o…</span></span>
<span><span class="co">#&gt;  7 SUPPLIED_SOURCE_ID_IND        TRUE   xsd:string      character      SUPPLIED_SOURCE_ID_IND is an…</span></span>
<span><span class="co">#&gt;  8 AIRPORT_NAME                  TRUE   xsd:string      character      AIRPORT_NAME is a business n…</span></span>
<span><span class="co">#&gt;  9 DESCRIPTION                   FALSE  xsd:string      character      DESCRIPTION describes the Oc…</span></span>
<span><span class="co">#&gt; 10 PHYSICAL_ADDRESS              FALSE  xsd:string      character      PHYSICAL_ADDRESS contains th…</span></span>
<span><span class="co">#&gt; # ℹ 32 more rows</span></span>
<span></span>
<span><span class="co"># Query the data with bcdc_query_geodata and filter + select:</span></span>
<span><span class="fu"><a href="../reference/bcdc_query_geodata.html">bcdc_query_geodata</a></span><span class="op">(</span><span class="st">"WHSE_IMAGERY_AND_BASE_MAPS.GSR_AIRPORTS_SVW"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">DESCRIPTION</span> <span class="op">==</span> <span class="st">"airport"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/select.html">select</a></span><span class="op">(</span><span class="va">AIRPORT_NAME</span>, <span class="va">LOCALITY</span>, <span class="va">NUMBER_OF_RUNWAYS</span><span class="op">)</span></span>
<span><span class="co">#&gt; Querying 'WHSE_IMAGERY_AND_BASE_MAPS.GSR_AIRPORTS_SVW' record</span></span>
<span><span class="co">#&gt; • Using collect() on this object will return 37 features and 11 fields</span></span>
<span><span class="co">#&gt; • At most six rows of the record are printed here</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 11 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 833323.9 ymin: 406886.6 xmax: 1266385 ymax: 1054950</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83 / BC Albers</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 12</span></span>
<span><span class="co">#&gt;   id     CUSTODIAN_ORG_DESCRI…¹ BUSINESS_CATEGORY_CL…² BUSINESS_CATEGORY_DE…³ OCCUPANT_TYPE_DESCRI…⁴</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;                  &lt;chr&gt;                  &lt;chr&gt;                  &lt;chr&gt;                 </span></span>
<span><span class="co">#&gt; 1 WHSE_… "Ministry of Forest, … airTransportation      Air Transportation     BC Airports           </span></span>
<span><span class="co">#&gt; 2 WHSE_… "Ministry of Forest, … airTransportation      Air Transportation     BC Airports           </span></span>
<span><span class="co">#&gt; 3 WHSE_… "Ministry of Forest, … airTransportation      Air Transportation     BC Airports           </span></span>
<span><span class="co">#&gt; 4 WHSE_… "Ministry of Forest, … airTransportation      Air Transportation     BC Airports           </span></span>
<span><span class="co">#&gt; 5 WHSE_… "Ministry of Forest, … airTransportation      Air Transportation     BC Airports           </span></span>
<span><span class="co">#&gt; 6 WHSE_… "Ministry of Forest, … airTransportation      Air Transportation     BC Airports           </span></span>
<span><span class="co">#&gt; # ℹ abbreviated names: ¹​CUSTODIAN_ORG_DESCRIPTION, ²​BUSINESS_CATEGORY_CLASS,</span></span>
<span><span class="co">#&gt; #   ³​BUSINESS_CATEGORY_DESCRIPTION, ⁴​OCCUPANT_TYPE_DESCRIPTION</span></span>
<span><span class="co">#&gt; # ℹ 7 more variables: SOURCE_DATA_ID &lt;chr&gt;, SUPPLIED_SOURCE_ID_IND &lt;chr&gt;, AIRPORT_NAME &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   LOCALITY &lt;chr&gt;, NUMBER_OF_RUNWAYS &lt;int&gt;, SEQUENCE_ID &lt;int&gt;, geometry &lt;POINT [m]&gt;</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andy Teucher, Sam Albers, Stephanie Hazlitt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
